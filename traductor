#!/usr/bin/env bash
: '
  Utilidad de bash para traducir ficheros desde la linea de comandos
  De <cualquier idioma> a <espanol>.
'
set -e
TRADUCCIONES=~/Traducciones

# estilos para prompt
  showmessage(){ echo -e "  \e[1;34;40m${@}\e[m" ;}
  showerror(){ echo -e "  \e[1;31;40m${@}\e[m" ;}
  trap ctrl_c INT
  ctrl_c(){ showerror "[*]Saliendo...\e[m\n" && tput cnorm && exit 0 ;}

# verifica que la entrada sea un archivo de texto
  if [ `file "$1" | grep -c 'text'` -ne 0 ]
    then
      ENTRADA="$1"
    else
      showerror ' !! entrada no valida, se esperaba un archivo de texto !!' && exit
  fi

# verifica dependencias
  solve-dependencies(){ source ./src/dependencies && install_translate-shell ;}
  ( command -V trans || solve-dependencies )> /dev/null
  ls $TRADUCCIONES || mkdir $TRADUCCIONES >/dev/null
  source ./src/animation

traductor(){
    local Entry=$1
    local Output=$TRADUCCIONES/$Entry_es.txt
    touch "$Output"
    echo "$(strings $Entry)" \
      | trans -u "Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/81.0"\
        -no-browser -b :es 2>/dev/null 1>$Output
    exit
}

# main
initflag(){ 
  animation &
  traductor "$ENTRADA"
  kill %2
  }
showmessage '['"$1"'] ====================> ['"$TRADUCCIONES"']' && initflag
